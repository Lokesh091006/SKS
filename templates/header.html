


<header class="navbar">

  <!-- ‚ò∞ LEFT (MOBILE ONLY) -->
  <div class="hamburger mobile-only" onclick="toggleMenu()">‚ò∞</div>

  <!-- üî• CENTER LOGO -->
  <a href="/" class="logo">
    <img src="https://image2url.com/r2/default/images/1769949284478-5cbbd602-d8ed-4067-afcb-2263ae95ce07.jpg" class="logo-peacock">
    
    <div class="logo-text">
      <div class="sks">SKS</div>
      <div class="mall">Mall</div>
    </div>
  </a>

  <!-- üîç RIGHT (MOBILE ONLY) -->
  <div class="search-icon mobile-only" onclick="toggleSearch()">üîç</div>

  <!-- üíª DESKTOP MENU (UNCHANGED) -->
  <nav class="menu desktop-only">
    <a href="/">HOME</a>
    <a href="/category/men">MEN</a>
    <a href="/category/women">WOMEN</a>
    <a href="/category/kids">KIDS</a>
  </nav>

  <!-- üíª DESKTOP RIGHT SIDE (UNCHANGED) -->
  <div class="nav-right desktop-only">
    <div class="search-icon" onclick="toggleSearch()">üîç</div>

    {% if session.get("username") %}
      <span class="nav-user">üë§ {{ session["username"] }}</span>

      {% if session.get("role") == "admin" %}
        <a href="/admin/dashboard">üëë Admin</a>
      {% endif %}

      <a href="/logout">Logout</a>
    {% else %}
      <a href="javascript:void(0)" onclick="openLogin()">Profile</a>
    {% endif %}

    <a href="/wishlist">‚ù§Ô∏è</a>
    <a href="/cart">üõí {{ session.get("cart", {})|length }}</a>
  </div>

</header>
<!-- SEARCH OVERLAY -->
<div id="searchBar" class="search-overlay">
  <div class="search-box">
    <input type="text" id="searchInput" placeholder="Search products...">
    <div id="searchResults" class="search-results"></div>
  </div>
</div>

<!-- MOBILE MENU -->
<nav class="mobile-menu mobile-only" id="mobileMenu">
  <a href="/">HOME</a>
  <a href="/category/men">MEN</a>
  <a href="/category/women">WOMEN</a>
  <a href="/category/kids">KIDS</a>
  
  {% if session.get("username") %}
    <a href="/profile">Profile</a>

    <!-- üëë ADMIN LINK (MOBILE) -->
    {% if session.get("role") == "admin" %}
      <a href="/admin/dashboard">üëë Admin</a>
    {% endif %}

    <a href="/logout">Logout</a>
  {% else %}
    <a href="javascript:void(0)" onclick="openLogin()">Login</a>
  {% endif %}
</nav>

<!-- LOGIN MODAL -->
<div id="loginModal" class="modal" style="display:none;">
  <div class="modal-box">
    <h3>Login / Signup</h3>
    <form method="post" action="/send-otp">
      <input type="text" name="mobile" pattern="[0-9]{10}" required placeholder="Mobile number">
      <button type="submit">Send OTP</button>
    </form>
  </div>
</div>

<script>

/* ===== MENU ===== */
function toggleMenu() {
  document.getElementById("mobileMenu").classList.toggle("show");
}

/* ===== SEARCH OVERLAY ===== */
function toggleSearch() {
  const bar = document.getElementById("searchBar");
  bar.classList.toggle("show");

  setTimeout(() => {
    const inp = document.getElementById("searchInput");
    if (inp) inp.focus();
  }, 120);
}

/* ===== LOGIN ===== */
function openLogin() {
  document.getElementById("loginModal").style.display = "flex";
}

window.onclick = function(e) {
  const modal = document.getElementById("loginModal");
  if (e.target === modal) modal.style.display = "none";
};

/* ===== LIVE SEARCH ===== */
document.addEventListener("DOMContentLoaded", function() {

  const input = document.getElementById("searchInput");
  const resultsBox = document.getElementById("searchResults");
  const searchBar = document.getElementById("searchBar");

  if (!input || !resultsBox) return;

  resultsBox.style.display = "none";

  input.addEventListener("input", function() {

    const q = this.value.trim();

    if (q.length < 2) {
      resultsBox.innerHTML = "";
      resultsBox.style.display = "none";
      return;
    }

    fetch("/live-search?q=" + encodeURIComponent(q))
      .then(r => r.json())
      .then(data => {

        if (!data.length) {
          resultsBox.innerHTML = "<div class='no-result'>No results</div>";
          resultsBox.style.display = "block";
          return;
        }

        let html = "";

        data.forEach(p => {
          html += `
          <div class="search-item" onclick="window.location='/product/${p.id}'">
            <img src="/static/${p.image || 'images/noimg.png'}">
            <div>
              <div>${p.name}</div>
              <div>‚Çπ${p.price}</div>
            </div>
          </div>`;
        });

        resultsBox.innerHTML = html;
        resultsBox.style.display = "block";

      })
      .catch(err => console.log("LIVE SEARCH ERROR:", err));
  });

  /* click outside overlay closes */
  if (searchBar) {
    searchBar.addEventListener("click", e => {
      if (e.target.id === "searchBar") {
        searchBar.classList.remove("show");
      }
    });
  }

  input.addEventListener("keydown", e => {
    if (e.key === "Enter") {
      window.location = "/?q=" + encodeURIComponent(input.value);
    }
  });

});

</script>
