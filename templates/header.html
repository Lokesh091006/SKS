<header class="navbar">

  <!-- LEFT : HAMBURGER -->
  <div class="hamburger mobile-only" onclick="toggleMenu()">‚ò∞</div>

  <!-- BRAND -->
  <a href="/" class="logo">
    <img src="https://image2url.com/r2/default/images/1769949284478-5cbbd602-d8ed-4067-afcb-2263ae95ce07.jpg" class="logo-peacock">
    <div class="logo-text">
      <div class="sks">SKS</div>
      <div class="mall">Mall</div>
    </div>
  </a>

  <!-- MENU -->
  <nav class="menu desktop-only">
    <a href="/">HOME</a>
    <a href="/category/men">MEN</a>
    <a href="/category/women">WOMEN</a>
    <a href="/category/kids">KIDS</a>
  </nav>

  <!-- RIGHT SIDE -->
  <div class="nav-right">

    <!-- SEARCH ICON -->
    <div class="search-icon" onclick="toggleSearch()">üîç</div>



    {% if session.get("username") %}
      <span class="nav-user desktop-only">üë§ {{ session["username"] }}</span>
      <a class="desktop-only" href="/logout">Logout</a>
    {% else %}
      <a class="desktop-only" href="javascript:void(0)" onclick="openLogin()">Profile</a>
    {% endif %}

    <a href="/wishlist">‚ù§Ô∏è</a>
    <a href="/cart">üõí {{ session.get("cart", {})|length }}</a>

  </div>

</header>

<!-- SEARCH BAR -->
<div id="searchBar" class="search-overlay">
  <div class="search-box">
    <input type="text" id="searchInput" placeholder="Search products...">
    <div id="searchResults" class="search-results"></div>
  </div>
</div>

<!-- MOBILE MENU -->
<nav class="mobile-menu mobile-only" id="mobileMenu">
  <a href="/">HOME</a>
  <a href="/category/men">MEN</a>
  <a href="/category/women">WOMEN</a>
  <a href="/category/kids">KIDS</a>

  {% if session.get("username") %}
    <a href="/profile">Profile</a>
    <a href="/logout">Logout</a>
  {% else %}
    <a href="javascript:void(0)" onclick="openLogin()">Login</a>
  {% endif %}
</nav>

<!-- LOGIN MODAL -->
<div id="loginModal" class="modal" style="display:none;">
  <div class="modal-box">
    <h3>Login / Signup</h3>
    <form method="post" action="/send-otp">
      <input type="text" name="mobile" pattern="[0-9]{10}" required placeholder="Mobile number">
      <button type="submit">Send OTP</button>
    </form>
  </div>
</div>

<script>
function toggleMenu() {
  document.getElementById("mobileMenu").classList.toggle("show");
}

function toggleSearch() {
  const bar = document.getElementById("searchBar");
  bar.classList.toggle("show");
  setTimeout(() => {
    const inp = document.getElementById("searchInput");
    if (inp) inp.focus();
  }, 150);
}

function openLogin() {
  document.getElementById("loginModal").style.display = "flex";
}

window.onclick = function(e) {
  const modal = document.getElementById("loginModal");
  if (e.target === modal) modal.style.display = "none";
};

/* ‚úÖ LIVE SEARCH */
document.addEventListener("DOMContentLoaded", function() {

  const input = document.getElementById("searchInput");
  const resultsBox = document.getElementById("searchResults");

  if (!input) return;

  input.addEventListener("input", function() {

    const q = this.value.trim();
    console.log("typing:", q);   // debug log

    if (q.length < 2) {
      resultsBox.innerHTML = "";
      return;
    }

    fetch("/live-search?q=" + encodeURIComponent(q))
      .then(r => r.json())
      .then(data => {

        console.log("results:", data);

        if (!data.length) {
          resultsBox.innerHTML = "<div class='no-result'>No results</div>";
          return;
        }

        let html = "";

        data.forEach(p => {
          html += `
          <div class="search-item" onclick="location.href='/product/${p.id}'">
            <img src="/static/${p.image || 'images/noimg.png'}">
            <div>
              <div>${p.name}</div>
              <div>‚Çπ${p.price}</div>
            </div>
          </div>`;
        });

        resultsBox.innerHTML = html;

      })
      .catch(err => console.log("LIVE SEARCH ERROR:", err));
  });

});
</script>
