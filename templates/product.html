<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ product.name }} | Mall SKS</title>

    <!-- RESPONSIVE -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- MAIN CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

</head>
<body>

{% include "header.html" %}

<!-- ================= PRODUCT PAGE ================= -->
<section class="product-page">

    <!-- LEFT : IMAGE -->
    <div class="product-image">
        <div class="slider">

    <!-- LEFT ARROW -->
    <button class="prev" id="prevBtn">‚ùÆ</button>

    <div class="slides" id="slides">
        <img src="{{ url_for('static', filename=product.image) }}">
        {% if product.image2 %}
        <img src="{{ url_for('static', filename=product.image2) }}">
        {% endif %}
        {% if product.image3 %}
        <img src="{{ url_for('static', filename=product.image3) }}">
        {% endif %}
    </div>

    <!-- RIGHT ARROW -->
    <button class="next" id="nextBtn">‚ùØ</button>

</div>

    </div>

    <!-- RIGHT : DETAILS -->
    <div class="product-details">

        <h1 class="product-title">{{ product.name }}</h1>
        <p class="product-price">‚Çπ {{ product.price }}</p>
        {% set all_out = sizes|selectattr("stock", "equalto", 0)|list|length == sizes|length %}

{% if all_out %}
<p style="color:red; font-weight:bold;">Sold Out üî•</p>
{% endif %}
        <p class="product-desc">
            Premium quality {{ product.name }} with modern fit.  
            Perfect for daily wear and special occasions.
        </p>

        <!-- SIZE SELECTION -->
        <div class="size-box">
            <label>Select Size:</label>
          <div class="sizes">
    {% for s in sizes %}
        
        {% if s.stock > 0 %}
            <span class="size">{{ s.size }}</span>
        
        {% else %}
            <span class="size sold">
                {{ s.size }} ‚ùå
            </span>
        {% endif %}
    
    {% endfor %}
</div>
            <input type="hidden" name="size" id="selectedSize">
        </div>

        <!-- QUANTITY -->
        <div class="qty-box">
            <label for="qty">Quantity</label>
            <select id="qty">
                {% for i in range(1,6) %}
                    <option value="{{ i }}">{{ i }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- DELIVERY -->
        

        <!-- ACTION BUTTONS -->
        <div class="product-buttons">

            <!-- WISHLIST -->
            <!-- WISHLIST -->
<div class="wishlist-wrap">
    <i id="wishlistIcon" class="fa-regular fa-heart"></i>
</div>

<!-- CART -->


<a href="#" id="addToCartBtn" class="btn-cart"
   {% if all_out %}style="pointer-events:none;opacity:0.5;"{% endif %}>
    üõí 
</a>

<a href="#" id="buyNowBtn" class="btn-buy"
   {% if all_out %}style="pointer-events:none;opacity:0.5;"{% endif %}>
     Buy Now
</a>




        </div>

        <!-- FEATURES -->
        <ul class="features">
            <li>‚úî 100% Original Products</li>
            
            <li>‚úî Cash on Delivery Available</li>

            
        </ul>

    </div>

</section>

{% include "footer.html" %}

<script>
document.addEventListener("DOMContentLoaded", function () {

    // ===== SLIDER =====
    let index = 0;
    const slides = document.getElementById("slides");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    nextBtn.addEventListener("click", () => {
        if (index < slides.children.length - 1) {
            index++;
            slides.style.transform = `translateX(-${index * 100}%)`;
        }
    });

    prevBtn.addEventListener("click", () => {
        if (index > 0) {
            index--;
            slides.style.transform = `translateX(-${index * 100}%)`;
        }
    });


    // ===== SIZE SELECT =====
    const sizes = document.querySelectorAll(".size");
    const hiddenInput = document.getElementById("selectedSize");

    sizes.forEach(size => {
        size.addEventListener("click", () => {
            sizes.forEach(s => s.classList.remove("active"));
            size.classList.add("active");
            hiddenInput.value = size.innerText;
        });
    });


    // ===== BUTTONS =====
    const addToCartBtn = document.getElementById("addToCartBtn");
    const buyNowBtn = document.getElementById("buyNowBtn");

    addToCartBtn.addEventListener("click", function (e) {
        e.preventDefault();
        if (!hiddenInput.value) {
            alert("Select size first!");
            return;
        }
        window.location.href = "{{ url_for('add_to_cart', product_id=product.id) }}" + "?size=" + encodeURIComponent(hiddenInput.value);
    });

    buyNowBtn.addEventListener("click", function (e) {
        e.preventDefault();
        if (!hiddenInput.value) {
            alert("Select size first!");
            return;
        }
        window.location.href = "{{ url_for('address', product_id=product.id) }}" + "?size=" + encodeURIComponent(hiddenInput.value);
    });


    // ===== ‚ù§Ô∏è WISHLIST =====
    const wishlistIcon = document.getElementById("wishlistIcon");

    // page load appudu already wishlist lo unte red
    const wishlist = {{ session.get("wishlist", [])|tojson }};
    if (wishlist.includes({{ product.id }})) {
        wishlistIcon.classList.add("fa-solid");
        wishlistIcon.classList.remove("fa-regular");
        wishlistIcon.style.color = "red";
    }

    wishlistIcon.addEventListener("click", function () {

        if (!hiddenInput.value) {
            alert("Select size first!");
            return;
        }

        fetch(`/add-to-wishlist/{{ product.id }}`)
            .then(res => res.json())
            .then(data => {

                if (data.status === "added") {
                    wishlistIcon.classList.add("fa-solid");
                    wishlistIcon.classList.remove("fa-regular");
                    wishlistIcon.style.color = "red";
                } else {
                    wishlistIcon.classList.add("fa-regular");
                    wishlistIcon.classList.remove("fa-solid");
                    wishlistIcon.style.color = "black";
                }

            });

    });

});

document.addEventListener("DOMContentLoaded", function(){

    document.querySelectorAll(".size").forEach(el=>{
        if(el.classList.contains("sold")){
            el.onclick = function(){
                alert("This size is sold out ‚ùå");
            }
        }
    });

});

</script>

</body>
</html>
